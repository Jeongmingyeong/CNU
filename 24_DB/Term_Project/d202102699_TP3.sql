-- TP3 answer --
DROP TABLE OrderDetail;
DROP TABLE Cart;
DROP TABLE Customer;
DROP TABLE CONTAIN;
DROP TABLE CATEGORY;
DROP TABLE Food;

CREATE TABLE Customer (
    cno VARCHAR(10),
    name VARCHAR(100) NOT NULL,
    password VARCHAR(100) NOT NULL,
    phoneno VARCHAR(20) NOT NULL,
    CONSTRAINT pk_customer PRIMARY KEY (cno)
);

CREATE TABLE Food (
    foodName VARCHAR(100),
    price NUMBER NOT NULL,
    CONSTRAINT pk_food PRIMARY KEY (foodName)
);

CREATE TABLE Category (
    categoryName VARCHAR(100),
    noOfFoods NUMBER NOT NULL,
    CONSTRAINT pk_category PRIMARY KEY (categoryName)
);

CREATE TABLE Contain (
    foodName VARCHAR(100),
    categoryName VARCHAR(100) NOT NULL,
    CONSTRAINT pk_contain PRIMARY KEY (foodName, categoryName),
    CONSTRAINT fk_contain1 FOREIGN KEY (foodName) REFERENCES Food(foodName),
    CONSTRAINT fk_contain2 FOREIGN KEY (categoryName) REFERENCES Category(categoryName)
);

CREATE TABLE Cart (
    id VARCHAR(5),
    orderDateTime TIMESTAMP,
    cno VARCHAR(10),
    CONSTRAINT pk_cart PRIMARY KEY (id),
    CONSTRAINT fk_cart FOREIGN KEY (cno) REFERENCES Customer(cno)
);

CREATE TABLE OrderDetail (
    itemNo NUMBER,
    id VARCHAR(5),
    quantity NUMBER,
    totalPrice NUMBER,
    foodName VARCHAR(100),
    CONSTRAINT pk_orderdetail PRIMARY KEY (itemNo, id),
    CONSTRAINT fk_orderdetail1 FOREIGN KEY (id) REFERENCES Cart(id),
    CONSTRAINT fk_orderdetail2 FOREIGN KEY (foodName) REFERENCES Food(foodName)
);


-- TP4 answer --
-- Food table에 20개의 음식 정보 구축 --
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('김밥', 5000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('떡볶이', 6000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('라볶이', 7000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('치즈떡볶이', 7000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('치즈라볶이', 8000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('냉면', 8000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('우동', 6000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('김치찌개', 8000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('순두부찌개', 8000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('된장찌개', 8000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('부대찌개', 10000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('돈까스', 12000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('과일빙수', 12000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('팥빙수', 9000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('소프트콘', 1200);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('공기밥', 1000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('콜라', 2000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('사이다', 2000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('소주', 5000);
INSERT INTO FOOD (FOODNAME, PRICE)
    VALUES ('맥주', 5000);

-- Category table에 최소 3개의 분류 정보 구축 --
INSERT INTO CATEGORY (CATEGORYNAME, NOOFFOODS)
    VALUES ('분식', 0);
INSERT INTO CATEGORY (CATEGORYNAME, NOOFFOODS)
    VALUES ('한식', 0);
INSERT INTO CATEGORY (CATEGORYNAME, NOOFFOODS)
    VALUES ('디저트', 0);
INSERT INTO CATEGORY (CATEGORYNAME, NOOFFOODS)
    VALUES ('추가 및 음료', 0);
INSERT INTO CATEGORY (CATEGORYNAME, NOOFFOODS)
    VALUES ('시즌메뉴(여름)', 0);

    
-- Contain table에 Food 테이블과의 관계 구축 --
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('김밥', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('떡볶이', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('라볶이', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('치즈떡볶이', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('치즈라볶이', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('냉면', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('냉면', '시즌메뉴(여름)');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('우동', '분식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('김치찌개', '한식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('순두부찌개', '한식'); 
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('된장찌개', '한식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('부대찌개', '한식');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('돈까스', '한식');    
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('과일빙수', '디저트');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('과일빙수', '시즌메뉴(여름)');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('팥빙수', '디저트');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('팥빙수', '시즌메뉴(여름)');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('소프트콘', '디저트');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('공기밥', '추가 및 음료');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('콜라', '추가 및 음료');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('사이다', '추가 및 음료');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('소주', '추가 및 음료');
INSERT INTO CONTAIN (FOODNAME, CATEGORYNAME)
    VALUES ('맥주', '추가 및 음료');
    
-- category table 의 음식개수 update --
UPDATE CATEGORY c
    SET c.NOOFFOODS = (SELECT COUNT(*) FROM CONTAIN ct WHERE c.CATEGORYNAME = ct.CATEGORYNAME);
    

-- customer table 에 최소 3명 이상의 회원 정보 구축 --
INSERT INTO CUSTOMER (CNO, NAME, PASSWORD, PHONENO)
    VALUES ('C0', '관리자', '1111', '010-1111-1111');
INSERT INTO CUSTOMER (CNO, NAME, PASSWORD, PHONENO)
    VALUES ('C1', '정민경', '1234', '010-1234-5678');
INSERT INTO CUSTOMER (CNO, NAME, PASSWORD, PHONENO)
    VALUES ('C2', '홍길동', '0000', '010-9876-6789');
INSERT INTO CUSTOMER (CNO, NAME, PASSWORD, PHONENO)
    VALUES ('C3', '오백이', '5252', '010-5025-0250');

-- cart table에 최소 2명 이상의 회원들의 주문 정보 구축 --
INSERT INTO CART (ID, ORDERDATETIME, CNO)
    VALUES (1, sysdate, 'C3');
INSERT INTO CART (ID, ORDERDATETIME, CNO)
    VALUES (2, sysdate-10, 'C3');
INSERT INTO CART (ID, ORDERDATETIME, CNO)
    VALUES (3, sysdate-3, 'C1');
    
-- orderdetail table 에 하나의 주문데이터에 대해 최소 2개 이상의 상세정보데이터 추가 --
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (1, 1, 3, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '김밥') * 3, '김밥');
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (2, 1, 2, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '콜라') * 2, '콜라');
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (3, 1, 2, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '사이다') * 2, '사이다');
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (1, 2, 2, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '김치찌개') * 2, '김치찌개');
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (2, 2, 1, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '소주') * 1, '소주');
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (1, 3, 2, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '소프트콘') * 2, '소프트콘');
INSERT INTO ORDERDETAIL (ITEMNO, ID, QUANTITY, TOTALPRICE, FOODNAME)
    VALUES (2, 3, 1, (SELECT PRICE FROM FOOD f WHERE f.FOODNAME = '과일빙수') * 1, '과일빙수');
    


